<?phpdefine('ROOT', dirname(__FILE__));define('TPLID', 'RUMBLE14');define('TPLPATH', './../rumble/template');define('IMGPATH', 'image');define('INAJAX', (isset($_SERVER['HTTP_X_REQUESTED_WITH']) && $_SERVER['HTTP_X_REQUESTED_WITH'] === 'XMLHttpRequest' || !empty($_GET['aaa']) && $_GET['aaa'] === '1') ? TRUE : FALSE);//define('GODMODE', TRUE);//include ROOT . '/../library/php/other_common.php';include ROOT . '/../bbs/source/class/class_core.php';include ROOT . '/include/func-global.php';C::app()->init();// Set up regular variables$schedule	= ['start' => strtotime('2014-07-10'), 'end' => strtotime('2014-08-25')];$stime		= microtime(TRUE);$title		= '';$isgm		= in_array($_G['uid'], ['8', '1333']);//error_reporting(E_ALL);date_default_timezone_set('Asia/Shanghai');//print_r(date_default_timezone_get());/*if($_SERVER['REQUEST_TIME'] >= strtotime('2014-08-24') && 	!DB::result_first('SELECT date FROM ext_rumble14_group WHERE date = \'2014-08-24\'')) {	$finalistscore = DB::result_first('SELECT id FROM ext_rumble14_score WHERE id IN (133, 196) ORDER BY score8 DESC');	DB::query('INSERT INTO ext_rumble14_group (date, info) VALUES (\'2014-08-24\', \'Final|1|1|573,' . $finalistscore . '\')');}*/if(empty($_GET['process'])) {	$_GET['page'] = empty($_GET['page']) || !in_array($_GET['page'], ['home', 'rank', 'report', 'timetable', 'rules', 'cooperate']) ? 'home' : $_GET['page'];	$title = [		'home' => '主页', 		'rank' => '排行榜', 		'report' => '战报', 		'timetable' => '赛程表', 		'rules' => '规则', 		'cooperate' => '合作'	];	// When rumble finishes, there's an ceremony, or when rumble not started, people cannot enter ranking and report page	if($schedule['end'] < $_SERVER['REQUEST_TIME'] && $page === 'home') $_GET['page'] = 'ceremony';	if($schedule['start'] > $_SERVER['REQUEST_TIME'] && in_array($_GET['page'], ['home', 'rank', 'report'])) $_GET['page'] = 'cooperate';	// Includes main processing file	if(($path = ROOT . '/page-' . $_GET['page'] . '.php') && file_exists($path)) include $path;	// Includes template file	include template('index_2', TPLID, TPLPATH);} elseif(INAJAX) {	include ROOT . '/process.php';	$return['etime'][] = microtime(TRUE) - $stime;	echo json_encode($return);} else {	echo 'Lately I\'ve been I\'ve been losing sleep~';}